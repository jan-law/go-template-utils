apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: quote-valid-raw-test
spec:
  policy-templates:
    - objectDefinition:
        apiVersion: policy.open-cluster-management.io/v1
        kind: ConfigurationPolicy
        metadata:
          name: quote-valid-raw-config
        spec:
          remediationAction: enforce
          severity: low
          # this is a comment and shouldn't be checked for extra " quotes
          object-templates-raw: |
            {{- range (lookup "v1" "ConfigMap" "default" "").items }}
            {{- if and .data.model (contains "Mustang" .data.model) }}
            - complianceType: musthave
              objectDefinition:
                kind: ConfigMap
                apiVersion: v1
                metadata:
                  name: '{{ .metadata.name }}'
                  namespace: '{{ printf "%v%v" .metadata.namespace "blah"}}'
                  labels:
                    ford.com/model: "Mustang"
                    name: '{{ $.ObjectName }}'
                    escaped: "this quote \" is escaped"
                    valid: 'this quote '' is a valid string'
                    valid-quote-at-start: '"{{ $.ObjectName }}'
                    valid-single-quote: "{{ printf "this apostrophe ' is valid" }}"
                    valid-string: '{{ printf "this apostrophe '' is valid" }}'
                    also-valid: '{{ printf "this is \"valid\""}}'
                    note: "this is a string and shouldn't be checked for extra single quotes"
                    multiline-config: '{{ $carModel := (fromConfigMap "default" "cool-car"
                    "model") }}{{ if eq "Shelby Mustang" $carModel }}{"model":"{{ $carModel }}"
                    }{{ else }}{{ "{}" | toLiteral }}{{ end }}'
            {{- end }}
            {{- end }}
